{{ define "main" }}
  <div class="d-flex align-items-center justify-content-center">
    <!-- Tabs -->
    <div
      x-data="{
selectedId: null,
init() {
// Set the first available tab on the page on page load.
this.$nextTick(() => this.select(this.$id('tab', 1)))
},
select(id) {
this.selectedId = id
},
isSelected(id) {
return this.selectedId === id
},
whichChild(el, parent) {
return Array.from(parent.children).indexOf(el) + 1
}
}"
      x-id="['tab']"
      class="mx-auto w-100">
      <!-- Tab List -->
      <ul
        x-ref="tablist"
        @keydown.right.prevent.stop="$focus.wrap().next()"
        @keydown.home.prevent.stop="$focus.first()"
        @keydown.page-up.prevent.stop="$focus.first()"
        @keydown.left.prevent.stop="$focus.wrap().prev()"
        @keydown.end.prevent.stop="$focus.last()"
        @keydown.page-down.prevent.stop="$focus.last()"
        role="tablist"
        class="d-flex mx-0 px-0 list-unstyled">
        <!-- Tab -->
        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-1"
            tabindex="0"
            aria-selected="true">
            Query Library
          </button>
        </li>

        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-2"
            tabindex="-1"
            aria-selected="false">
            Document template
          </button>
        </li>
        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-2"
            tabindex="-1"
            aria-selected="false">
            Doc Categories
          </button>
        </li>
        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-2"
            tabindex="-1"
            aria-selected="false">
            File Metadata Editor
          </button>
        </li>
        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-2"
            tabindex="-1"
            aria-selected="false">
            Doc Types
          </button>
        </li>
        <li>
          <button
            :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
            @click="select($el.id)"
            @mousedown.prevent=""
            @focus="select($el.id)"
            type="button"
            :tabindex="isSelected($el.id) ? 0 : -1"
            :aria-selected="isSelected($el.id)"
            :class="isSelected($el.id) ? 'border-primary text-primary border-opacity-75' : 'border-opacity-10'"
            class="d-inline-flex px-4 bg-white py-3 border-top-0 border-4 border-start-0 border-bottom border-end-0"
            role="tab"
            id="tab-1-2"
            tabindex="-1"
            aria-selected="false">
            Query/Document Dictionary
            <i class="text-muted ps-2"> (Matrix) </i>
          </button>
        </li>
      </ul>

      <!-- Panels -->
      <div role="tabpanels" class=" w-100">
        <!-- Panel -->
        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-1"
          style="">
          {{ partial "pdf-tag-editor/queryEditor.html" . }}
          <!-- {{ partial "pdf-tag-editor/queryManager.html" . }} -->
        </section>

        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-2"
          style="display: none;">
          {{ partial "pdf-tag-editor/documentTemplatesEditor.html" . }}

        </section>
        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-3"
          style="display: none;">
          {{ partial "pdf-tag-editor/documentCategoriesEditor.html" . }}

        </section>
        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-4"
          style="display: none;">
          {{ partial "pdf-tag-editor/fileMetadataEditor.html" . }}
        </section>
        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-5"
          style="display: none;">
          {{ partial "pdf-tag-editor/documentTypesEditor.html" . }}
        </section>

        <section
          x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
          :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
          role="tabpanel"
          class="w-100 px-2"
          aria-labelledby="tab-1-5"
          style="display: none;">
          <div x-data="docTypesMatrix()" x-init="init()">
            <h6 class="">Document Types Matrix</h6>

            <!-- Group By Selector -->
            <div class="mb-4">
              <label class="form-label">Group By:</label>
              <select class="form-select" x-model="groupBy">
                <option value="">None</option>
                <option value="name">Doc Type Name</option>
                <option value="entity">Entity</option>
                <option value="queries">Queries</option>
                <option value="category">Doc Categ</option>
              </select>
            </div>

            <!-- Matrix Table -->
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Doc Type Name</th>
                  <th scope="col">Entity</th>
                  <th scope="col">Queries</th>
                  <th scope="col">Doc Categ</th>
                </tr>
              </thead>
              <tbody>
                <!-- Grouped Rows -->
                <template
                  x-for="(group, groupKey) in groupedData"
                  :key="groupKey">
                  <!-- Display Group Header if Grouping is Applied -->
                  <tr x-show="groupBy">
                    <td colspan="4" x-text="groupKey"></td>
                  </tr>

                  <!-- Display Each Item in the Group -->
                  <template
                    x-for="item in group"
                    :key="item.name + item.entity">
                    <tr>
                      <td x-text="item.name"></td>
                      <td x-text="item.entity"></td>
                      <td>
                        <div class="d-flex gap-1">
                          <template x-for="query in item.queries" :key="query">
                            <span
                              x-text="query"
                              class="badge text-bg-primary"></span>
                          </template>
                        </div>
                      </td>
                      <td x-text="item.category"></td>
                    </tr>
                  </template>
                </template>

                <!-- Display Rows Without Grouping -->
                <template x-if="!groupBy">
                  <template
                    x-for="item in docTypes"
                    :key="item.name + item.entity">
                    <tr>
                      <td x-text="item.name"></td>
                      <td x-text="item.entity"></td>
                      <td>
                        <div class="d-flex gap-1">
                          <template x-for="query in item.queries" :key="query">
                            <span
                              x-text="query"
                              class="badge text-bg-primary"></span>
                          </template>
                        </div>
                      </td>
                      <td x-text="item.category"></td>
                    </tr>
                  </template>
                </template>
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </div>
  </div>

  <div class="d-flex flex-column gap-2"></div>
{{ end }}
