export default function fieldManager() {
  return {
    pdfSupport: true,
    selectedFields: [],
    currentIndex: 0,
    queries: [
      {
        name: 'Query 1',
        value: 'valQuery01',
      },
      {
        name: 'Query 2',
        value: 'valQuery02',
      },
      {
        name: 'Query 3',
        value: 'valQuery03',
      },
      {
        name: 'Query 4',
        value: 'valQuery04',
      },
    ],
    fileMetadata: [
      {
        active: true,
        fields: [
          {
            active: true,
            draftState: false,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'none',
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'embedded',
            name: 'P1-Field Name with Query None',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: null,
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query NUll',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'text',
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'text',
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P1-Field Name with Query',
          },
        ],
      },
      {
        active: false,
        fields: [
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'none',
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'PG2 Field Name with Query',
          },
        ],
      },
      {
        active: false,
        fields: [
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'query',
            mappingValue: 'valQuery01',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P3 - Field Name with Query',
          },
          {
            active: false,
            draftState: true,
            width: 20,
            height: 20,
            xCoord: 0,
            yCoord: 0,
            fontSize: 12,
            fontName: 'Arial',
            mapping: 'text',
            mappingValue: 'mappingValue',
            newMapping: {
              queryName: null,
            },
            type: 'WDX',
            name: 'P3 - Field Name with Mapping',
          },
        ],
      },
    ],

    toggleSelection(fileIndex, fieldIndex, event) {
      console.log(event);
      //   if (event.ctrlKey || event.metaKey) {
      //     const field = { fileIndex, fieldIndex };
      //     console.log(fileIndex, fieldIndex);
      //   }

      const field = { fileIndex, fieldIndex };
      //   Only handle selection when Ctrl (or Meta) is pressed
      if (event.ctrlKey || event.metaKey) {
        const existingIndex = this.selectedFields.findIndex(
          (f) => f.fileIndex === fileIndex && f.fieldIndex === fieldIndex,
        );

        if (existingIndex !== -1) {
          // Remove from selection if already selected
          this.selectedFields.splice(existingIndex, 1);
        } else {
          // Add to selection
          this.selectedFields.push(field);
        }
      }
    },
    moveSelectedFields(targetPageIndex) {
      // Move all selected fields to the target page
      this.selectedFields.forEach(({ fileIndex, fieldIndex }) => {
        const field = this.fileMetadata[fileIndex].fields.splice(fieldIndex, 1)[0];
        this.fileMetadata[targetPageIndex].fields.push(field);
      });

      // Clear the basket
      this.selectedFields = [];
    },

    setActive(fileIndex, fieldIndex) {
      this.fileMetadata.forEach((file, fIndex) => {
        // Set the parent active state
        file.active = fIndex === fileIndex;

        // Set the fields active state
        file.fields.forEach((field, index) => {
          field.active = fIndex === fileIndex && index === fieldIndex;
        });
      });
    },

    moveField(fileIndex, fieldIndex, targetPageIndex) {
      // Remove the field from the current page
      const field = this.fileMetadata[fileIndex].fields.splice(fieldIndex, 1)[0];

      // Add the field to the target page
      this.fileMetadata[targetPageIndex].fields.push(field);
    },
    getFieldCurrentPage(fileIndex, fieldIndex) {
      // Check if the field exists in the specified page (fileIndex)
      if (this.fileMetadata[fileIndex] && this.fileMetadata[fileIndex].fields[fieldIndex]) {
        // Return the 1-based page index
        return fileIndex + 1;
      }
      return null; // Return null if the field is not found
    },

    updateMapping() {
      if (this.item.newMapping.queryName) {
        this.item.mapping = 'query';
      }
    },

    initializeMapping(fields) {
      fields.forEach((field) => {
        if (field.mapping === 'query') {
          field.newMapping.queryName = field.mappingValue;
        }
      });
    },

    init() {
      // Initialize the mappings for all fields in all files
      this.fileMetadata.forEach((file) => {
        this.initializeMapping(file.fields);
      });
    },

    scrollToActiveFile(index) {
      const container = document.querySelector('#fields'); // Target the specific section
      console.log(container);

      if (!container) return; // Exit if the container is not found

      if (index === 0) {
        // Scroll the container to the top
        this.setActive(index);
        container.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        // Find the heading inside the container
        const heading = container.querySelector(`#file-heading-${index}`);
        this.setActive(index);
        if (heading) {
          // Scroll the container to bring the heading into view
          heading.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });
        }
      }
    },

    next() {
      if (this.currentIndex < this.fileMetadata.length - 1) {
        this.setActive(this.currentIndex + 1);
        this.scrollToActiveFile(this.currentIndex + 1);
      }
    },
    prev() {
      if (this.currentIndex > 0) {
        this.setActive(this.currentIndex - 1);
        this.scrollToActiveFile(this.currentIndex - 1);
      }
    },

    xxxscrollToActiveFile(index) {
      if (index === 0) {
        // Scroll to the top of the page
        const heading = document.querySelector(`#field-heading-${index}0`);
        if (heading) {
          heading.scrollIntoView({ behavior: 'smooth' });
        }
      } else {
        // Scroll to the heading
        const heading = document.querySelector(`#file-heading-${index}`);
        console.log(heading);
        if (heading) {
          heading.scrollIntoView({ behavior: 'smooth' });
        }
      }
    },

    addField(field) {
      this.fields.push(field);
    },
  };
}
